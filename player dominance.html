<!DOCTYPE html>
<meta charset="utf-8">
<<head>
    <meta charset="utf-8">
    <title></title>
    <style type="text/css" media="screen">
    body {
        background: #131e30;
    }
    </style>
</head>
<body>
    <section id="graph"></section>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        var players = {};
        d3.csv("usopen.csv", function(data) {
            data.map(function(d) {
                if ( d.gender === "m" ) {
                    if ( players[d.winner] === undefined ) {
                        players[d.winner] = 1;
                    } else { 
                        players[d.winner] = players[d.winner] + 1;
                    }
                    if ( players[d.loser] === undefined ) {
                        players[d.loser] = 1;
                    } else { 
                        players[d.loser] = players[d.loser] + 1;
                    }
                }
            });
            
            /*var values = [];
            for ( var key in players ) {
                values.push({name: key, className: key, size: players[key]});
            }*/

            var json = {"player_occurances": players};
  
    // D3 Bubble Chart 

    var diameter = 600;
    var color = d3.scale.category20c();

    var svg = d3.select('#graph').append('svg')
                    .attr('width', diameter)
                    .attr('height', diameter);

    var bubble = d3.layout.pack()
                .size([diameter, diameter])
                .value(function(d) {return d.size;})
                .padding(3);
  
  // generate data with calculated layout values
  var nodes = bubble.nodes(processData(json))
                        .filter(function(d) { return !d.children; }); // filter out the outer bubble
 
  var vis = svg.selectAll('circle')
                    .data(nodes);
  
  vis.enter().append('circle')
            .style("fill", function (d, i) { return color(i); } )
            .attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; })
            .attr('r', function(d) { return d.r; })
            .attr('class', function(d) { return d.className; });
              
  vis.selectAll("text").enter().append("text")
            .attr("x", 1)
            .text("y", 1)
            .text("fill");
              
  function processData(data) {
    var obj = data.player_occurances;

    var newDataSet = [];

    for(var prop in obj) {
      newDataSet.push({name: prop, className: prop.toLowerCase(), size: obj[prop]});
    }
    return {children: newDataSet};
  }

        });
    </script>
</body>